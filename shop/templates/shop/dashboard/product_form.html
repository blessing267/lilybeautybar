{% extends "shop/base.html" %}
{% block content %}

<div class="max-w-lg mx-auto py-10 px-4">
  <h1 class="text-2xl font-semibold mb-6">
    {% if product %}Edit Product{% else %}Add Product{% endif %}
  </h1>

  <form method="POST" enctype="multipart/form-data" class="space-y-4">
    {% csrf_token %}
    {{ form.as_p }}

    <!-- Image preview -->
    <div class="mt-4">
      <p class="text-sm text-slate-600 mb-1">Image Preview:</p>
      <img id="imagePreview" 
           src="{% if product and product.image %}{{ product.image.url }}{% endif %}" 
           alt="Image Preview" 
           class="w-full h-40 object-cover rounded-lg border" />
    </div>

    <button class="px-5 py-3 bg-[var(--brand)] text-white rounded-lg mt-4">
      {% if product %}Update{% else %}Save{% endif %}
    </button>
  </form>
</div>

<!-- JS for live image preview -->
<script>
  const imageInput = document.querySelector('input[type="file"]');
  const imagePreview = document.getElementById('imagePreview');

  imageInput.addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();
      reader.addEventListener("load", function() {
        imagePreview.setAttribute("src", this.result);
      });
      reader.readAsDataURL(file);
    } else {
      imagePreview.setAttribute("src", "");
    }
  });
</script>

{% endblock %}
